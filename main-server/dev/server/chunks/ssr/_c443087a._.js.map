{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/nghiaphunng18/HustTutorial/ITSS.1.20251/components/features/interactive-slides/CreatePresentationDialog.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport axios from \"@/lib/axios\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useToast } from \"@/contexts/ToastContext\";\nimport { UploadCloud } from \"lucide-react\";\n\ntype FormData = {\n  name: string;\n  fileList: FileList;\n};\n\ninterface Props {\n  open: boolean;\n  onClose: () => void;\n  onSuccess: () => void;\n}\n\nexport default function CreatePresentationDialog({\n  open,\n  onClose,\n  onSuccess,\n}: Props) {\n  const { user } = useAuth();\n  const toast = useToast();\n\n  // State riêng để handle quá trình upload file\n  const [isUploading, setIsUploading] = useState(false);\n\n  const {\n    register,\n    handleSubmit,\n    reset,\n    formState: { errors, isSubmitting },\n  } = useForm<FormData>();\n\n  if (!open) return null;\n\n  const onSubmit = async (data: FormData) => {\n    if (!user?.id) return;\n\n    // 1. Lấy file từ FileList\n    const file = data.fileList[0];\n    if (!file) {\n      toast.error(\"Lỗi\", \"Vui lòng chọn file PDF\");\n      return;\n    }\n\n    try {\n      setIsUploading(true); // Bắt đầu loading upload\n\n      // 2. Upload File trước\n      const uploadFormData = new FormData();\n      uploadFormData.append(\"file\", file);\n\n      const uploadRes = await axios.post(\n        \"/api/presentations/upload\",\n        uploadFormData,\n        {\n          headers: { \"Content-Type\": \"multipart/form-data\" },\n        }\n      );\n\n      const fileUrl = uploadRes.data.url; // Nhận về: /uploads/presentations/123-abc.pdf\n\n      // 3. Tạo bài giảng với fileUrl vừa nhận được\n      await axios.post(\"/api/presentations\", {\n        userId: user.id,\n        name: data.name,\n        fileUrl: fileUrl,\n      });\n\n      reset();\n      toast.success(\"Thành công\", \"Đã tạo bài giảng mới\");\n      onSuccess();\n      onClose();\n    } catch (error) {\n      console.error(\"Failed:\", error);\n      toast.error(\"Lỗi\", \"Có lỗi xảy ra khi upload hoặc tạo bài giảng\");\n    } finally {\n      setIsUploading(false); // Tắt loading upload\n    }\n  };\n\n  const isLoading = isSubmitting || isUploading;\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-in fade-in duration-200\">\n      <div className=\"w-full max-w-md bg-white rounded-lg shadow-xl p-6 relative\">\n        <button\n          onClick={onClose}\n          className=\"absolute top-4 right-4 text-gray-400 hover:text-gray-600\"\n        >\n          ✕\n        </button>\n\n        <h2 className=\"text-xl font-bold mb-4 text-gray-800\">\n          Tạo bài giảng mới\n        </h2>\n\n        <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-4\">\n          {/* Tên bài giảng */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Tên bài giảng <span className=\"text-red-500\">*</span>\n            </label>\n            <input\n              {...register(\"name\", { required: \"Vui lòng nhập tên bài giảng\" })}\n              className={`w-full border rounded-md px-3 py-2 outline-none focus:ring-2 focus:ring-blue-500 ${\n                errors.name ? \"border-red-500\" : \"border-gray-300\"\n              }`}\n              placeholder=\"VD: Chương 2 - Scrum Framework\"\n            />\n            {errors.name && (\n              <p className=\"text-red-500 text-xs mt-1\">{errors.name.message}</p>\n            )}\n          </div>\n\n          {/* Upload File Input */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              File bài giảng (PDF) <span className=\"text-red-500\">*</span>\n            </label>\n            <div className=\"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:bg-gray-50 transition-colors cursor-pointer relative\">\n              <div className=\"space-y-1 text-center\">\n                <UploadCloud className=\"mx-auto h-12 w-12 text-gray-400\" />\n                <div className=\"flex text-sm text-gray-600\">\n                  <label className=\"relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none\">\n                    <span>Upload a file</span>\n                    <input\n                      {...register(\"fileList\", {\n                        required: \"Vui lòng chọn file\",\n                      })}\n                      type=\"file\"\n                      accept=\"application/pdf\"\n                      className=\"sr-only\"\n                    />\n                  </label>\n                  <p className=\"pl-1\">or drag and drop</p>\n                </div>\n                <p className=\"text-xs text-gray-500\">PDF up to 10MB</p>\n              </div>\n            </div>\n            {/* Hiển thị lỗi file */}\n            {errors.fileList && (\n              <p className=\"text-red-500 text-xs mt-1\">\n                {errors.fileList.message}\n              </p>\n            )}\n          </div>\n\n          {/* Buttons */}\n          <div className=\"flex justify-end gap-3 mt-6 pt-2 border-t border-gray-100\">\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200\"\n            >\n              Hủy\n            </button>\n            <button\n              type=\"submit\"\n              disabled={isLoading}\n              className=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2\"\n            >\n              {isLoading && (\n                <span className=\"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full\" />\n              )}\n              {isUploading ? \"Đang tải lên...\" : \"Tạo bài giảng\"}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 308, "column": 0}, "map": {"version":3,"sources":["file:///home/nghiaphunng18/HustTutorial/ITSS.1.20251/app/%5Blocale%5D/dashboard/teacher/presentations/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useCallback, useEffect, useState } from \"react\";\nimport axios from \"@/lib/axios\";\nimport { Presentation } from \"@/types/presentation\";\nimport CreatePresentationDialog from \"@/components/features/interactive-slides/CreatePresentationDialog\";\nimport { Plus, FileText, Edit } from \"lucide-react\";\nimport Link from \"next/link\";\nimport { useParams } from \"next/navigation\";\nimport { useAuth } from \"@/contexts/AuthContext\";\n\nexport default function PresentationsPage() {\n  const { user, isAuthenticated, isLoading: authLoading } = useAuth();\n  const [presentations, setPresentations] = useState<Presentation[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n\n  const params = useParams();\n  const locale = (params?.locale as string) || \"vi\";\n\n  const fetchPresentations = useCallback(async () => {\n    if (!user) return;\n\n    try {\n      setIsLoading(true);\n      const res = await axios.get(`/api/presentations/teacher/${user.id}`);\n      setPresentations(res.data);\n    } catch (error) {\n      console.error(error);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [user]);\n\n  useEffect(() => {\n    if (isAuthenticated) {\n      fetchPresentations();\n    }\n  }, [isAuthenticated, fetchPresentations]);\n\n  if (authLoading) {\n    return <div className=\"p-6\">Đang xác thực...</div>;\n  }\n\n  if (!isAuthenticated) {\n    return null;\n  }\n\n  return (\n    <div className=\"p-6 max-w-7xl mx-auto\">\n      {/* Header */}\n      <div className=\"flex justify-between items-center mb-8\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-gray-900\">\n            Bài giảng tương tác\n          </h1>\n          <p className=\"text-gray-500 text-sm mt-1\">\n            Quản lý và trình chiếu các slide có câu hỏi tương tác.\n          </p>\n        </div>\n        <button\n          onClick={() => setIsDialogOpen(true)}\n          className=\"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition\"\n        >\n          <Plus size={20} />\n          Tạo mới\n        </button>\n      </div>\n\n      {/* Content */}\n      {isLoading ? (\n        <div className=\"text-center py-10\">Đang tải dữ liệu...</div>\n      ) : presentations.length === 0 ? (\n        <div className=\"text-center py-20 bg-gray-50 rounded-lg border border-dashed border-gray-300\">\n          <FileText className=\"mx-auto h-12 w-12 text-gray-400 mb-3\" />\n          <h3 className=\"text-lg font-medium text-gray-900\">\n            Chưa có bài giảng nào\n          </h3>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {presentations.map((p) => (\n            <div key={p.id} className=\"bg-white border rounded-lg p-5\">\n              <h3 className=\"font-semibold\">{p.name}</h3>\n\n              <div className=\"flex gap-2 mt-4\">\n                <Link\n                  href={`/${locale}/dashboard/teacher/presentations/${p.id}/edit`}\n                  className=\"text-blue-600\"\n                >\n                  <Edit size={16} /> Biên tập\n                </Link>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n\n      <CreatePresentationDialog\n        open={isDialogOpen}\n        onClose={() => setIsDialogOpen(false)}\n        onSuccess={fetchPresentations}\n      />\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AACA;AACA;AATA;;;;;;;;;AAWe,SAAS;IACtB,MAAM,EAAE,IAAI,EAAE,eAAe,EAAE,WAAW,WAAW,EAAE,GAAG,IAAA,mIAAO;IACjE,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,iNAAQ,EAAiB,EAAE;IACrE,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAC3C,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAC;IAEjD,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,SAAS,AAAC,QAAQ,UAAqB;IAE7C,MAAM,qBAAqB,IAAA,oNAAW,EAAC;QACrC,IAAI,CAAC,MAAM;QAEX,IAAI;YACF,aAAa;YACb,MAAM,MAAM,MAAM,uHAAK,CAAC,GAAG,CAAC,CAAC,2BAA2B,EAAE,KAAK,EAAE,EAAE;YACnE,iBAAiB,IAAI,IAAI;QAC3B,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC;QAChB,SAAU;YACR,aAAa;QACf;IACF,GAAG;QAAC;KAAK;IAET,IAAA,kNAAS,EAAC;QACR,IAAI,iBAAiB;YACnB;QACF;IACF,GAAG;QAAC;QAAiB;KAAmB;IAExC,IAAI,aAAa;QACf,qBAAO,8OAAC;YAAI,WAAU;sBAAM;;;;;;IAC9B;IAEA,IAAI,CAAC,iBAAiB;QACpB,OAAO;IACT;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BAEb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;;0CACC,8OAAC;gCAAG,WAAU;0CAAmC;;;;;;0CAGjD,8OAAC;gCAAE,WAAU;0CAA6B;;;;;;;;;;;;kCAI5C,8OAAC;wBACC,SAAS,IAAM,gBAAgB;wBAC/B,WAAU;;0CAEV,8OAAC,0MAAI;gCAAC,MAAM;;;;;;4BAAM;;;;;;;;;;;;;YAMrB,0BACC,8OAAC;gBAAI,WAAU;0BAAoB;;;;;uBACjC,cAAc,MAAM,KAAK,kBAC3B,8OAAC;gBAAI,WAAU;;kCACb,8OAAC,0NAAQ;wBAAC,WAAU;;;;;;kCACpB,8OAAC;wBAAG,WAAU;kCAAoC;;;;;;;;;;;qCAKpD,8OAAC;gBAAI,WAAU;0BACZ,cAAc,GAAG,CAAC,CAAC,kBAClB,8OAAC;wBAAe,WAAU;;0CACxB,8OAAC;gCAAG,WAAU;0CAAiB,EAAE,IAAI;;;;;;0CAErC,8OAAC;gCAAI,WAAU;0CACb,cAAA,8OAAC,uKAAI;oCACH,MAAM,CAAC,CAAC,EAAE,OAAO,iCAAiC,EAAE,EAAE,EAAE,CAAC,KAAK,CAAC;oCAC/D,WAAU;;sDAEV,8OAAC,mNAAI;4CAAC,MAAM;;;;;;wCAAM;;;;;;;;;;;;;uBARd,EAAE,EAAE;;;;;;;;;;0BAgBpB,8OAAC,uLAAwB;gBACvB,MAAM;gBACN,SAAS,IAAM,gBAAgB;gBAC/B,WAAW;;;;;;;;;;;;AAInB","debugId":null}}]
}
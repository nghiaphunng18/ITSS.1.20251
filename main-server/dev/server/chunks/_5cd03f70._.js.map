{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///home/nghiaphunng18/HustTutorial/ITSS.1.20251/lib/prisma.ts"],"sourcesContent":["import \"dotenv/config\";\nimport { PrismaPg } from '@prisma/adapter-pg'\nimport { PrismaClient } from '../prisma/generated/client';\n\nconst connectionString = `${process.env.POSTGRES_URL}`\n\nconst adapter = new PrismaPg({ connectionString })\nconst prisma = new PrismaClient({ adapter })\n\nexport { prisma }"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;AAEA,MAAM,mBAAmB,GAAG,QAAQ,GAAG,CAAC,YAAY,EAAE;AAEtD,MAAM,UAAU,IAAI,yKAAQ,CAAC;IAAE;AAAiB;AAChD,MAAM,SAAS,IAAI,wJAAY,CAAC;IAAE;AAAQ","debugId":null}},
    {"offset": {"line": 35, "column": 0}, "map": {"version":3,"sources":["file:///home/nghiaphunng18/HustTutorial/ITSS.1.20251/app/api/classes/%5Bid%5D/assignments/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/prisma\";\n\n// GET /api/classes/[id]/assignments - Get all assignments for a class\nexport async function GET(\n  req: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params;\n    const { searchParams } = new URL(req.url);\n    const studentId = searchParams.get(\"studentId\");\n    const groupId = searchParams.get(\"groupId\");\n\n    let assignments;\n\n    if (studentId) {\n      // Get assignments for a specific student (including their submissions)\n      // Find student's group in this class\n      const studentGroup = await prisma.groupMember.findFirst({\n        where: {\n          studentId,\n          group: {\n            classId: id,\n          },\n        },\n        include: {\n          group: true,\n        },\n      });\n\n      assignments = await prisma.assignment.findMany({\n        where: {\n          classId: id,\n          status: \"PUBLISHED\",\n          OR: [\n            { groupId: null }, // Assignments for all students\n            { groupId: studentGroup?.groupId }, // Assignments for student's group\n          ],\n        },\n        include: {\n          class: {\n            select: {\n              id: true,\n              name: true,\n              code: true,\n            },\n          },\n          createdBy: {\n            select: {\n              id: true,\n              name: true,\n              avatar: true,\n            },\n          },\n          group: {\n            select: {\n              id: true,\n              name: true,\n            },\n          },\n          attachments: true,\n          submissions: {\n            where: {\n              studentId,\n            },\n            select: {\n              id: true,\n              status: true,\n              submittedAt: true,\n              grade: true,\n              feedback: true,\n              attachments: {\n                select: {\n                  id: true,\n                  fileName: true,\n                  fileUrl: true,\n                  fileSize: true,\n                  mimeType: true,\n                },\n              },\n            },\n          },\n          _count: {\n            select: {\n              submissions: true,\n            },\n          },\n        },\n        orderBy: {\n          dueDate: \"asc\",\n        },\n      });\n    } else {\n      // Get all assignments for teachers\n      assignments = await prisma.assignment.findMany({\n        where: {\n          classId: id,\n          ...(groupId && groupId !== \"all\" ? { groupId } : {}),\n        },\n        include: {\n          createdBy: {\n            select: {\n              id: true,\n              name: true,\n              avatar: true,\n            },\n          },\n          group: {\n            select: {\n              id: true,\n              name: true,\n            },\n          },\n          attachments: true,\n          _count: {\n            select: {\n              submissions: true,\n            },\n          },\n        },\n        orderBy: {\n          createdAt: \"desc\",\n        },\n      });\n    }\n\n    return NextResponse.json(assignments);\n  } catch (error) {\n    console.error(\"Error fetching assignments:\", error);\n    return NextResponse.json(\n      { error: \"Failed to fetch assignments\" },\n      { status: 500 }\n    );\n  }\n}\n\n// POST /api/classes/[id]/assignments - Create a new assignment\nexport async function POST(\n  req: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params;\n    const {\n      title,\n      description,\n      dueDate,\n      maxPoints,\n      groupId,\n      isSeparateSubmission,\n      createdById,\n      attachments,\n    } = await req.json();\n\n    if (!title || !dueDate || !createdById) {\n      return NextResponse.json(\n        { error: \"Missing required fields\" },\n        { status: 400 }\n      );\n    }\n\n    // Create assignment\n    const assignment = await prisma.assignment.create({\n      data: {\n        classId: id,\n        groupId: groupId || null,\n        title,\n        description,\n        dueDate: new Date(dueDate),\n        maxPoints: maxPoints || 100,\n        status: \"PUBLISHED\",\n        isSeparateSubmission:\n          isSeparateSubmission !== undefined ? isSeparateSubmission : true,\n        createdById,\n        attachments: attachments\n          ? {\n              create: attachments.map((att: any) => ({\n                fileName: att.fileName,\n                fileUrl: att.fileUrl,\n                fileSize: att.fileSize,\n                mimeType: att.mimeType,\n              })),\n            }\n          : undefined,\n      },\n      include: {\n        createdBy: {\n          select: {\n            id: true,\n            name: true,\n            avatar: true,\n          },\n        },\n        group: {\n          select: {\n            id: true,\n            name: true,\n            members: {\n              select: {\n                studentId: true,\n              },\n            },\n          },\n        },\n        attachments: true,\n      },\n    });\n\n    // Create notifications for affected students\n    const classData = await prisma.class.findUnique({\n      where: { id },\n      select: {\n        name: true,\n        enrollments: {\n          where: { status: \"ACTIVE\" },\n          select: { studentId: true },\n        },\n      },\n    });\n\n    if (!classData) {\n      return NextResponse.json(assignment, { status: 201 });\n    }\n\n    // Get notification category\n    let category = await prisma.notificationCategory.findUnique({\n      where: { code: \"ASSIGNMENT_CREATED\" },\n    });\n\n    if (!category) {\n      category = await prisma.notificationCategory.create({\n        data: {\n          code: \"ASSIGNMENT_CREATED\",\n          name: \"Bài tập mới\",\n          description: \"Thông báo khi có bài tập mới được giao\",\n          icon: \"FiFileText\",\n          color: \"blue\",\n          priority: \"NORMAL\",\n        },\n      });\n    }\n\n    // Determine which students to notify\n    let studentIds: string[];\n    if (groupId && assignment.group) {\n      studentIds = assignment.group.members.map((m) => m.studentId);\n    } else {\n      studentIds = classData.enrollments.map((e) => e.studentId);\n    }\n\n    // Create notifications\n    await prisma.notification.createMany({\n      data: studentIds.map((studentId) => ({\n        userId: studentId,\n        categoryId: category.id,\n        title: groupId ? `Bài tập nhóm mới: ${title}` : `Bài tập mới: ${title}`,\n        message: `Giáo viên đã giao bài tập mới trong lớp ${\n          classData.name\n        }. Hạn nộp: ${new Date(dueDate).toLocaleDateString(\"vi-VN\")}`,\n        link: `/dashboard/student/assignments/${assignment.id}`,\n        priority: \"NORMAL\",\n        metadata: {\n          assignmentId: assignment.id,\n          classId: id,\n          groupId: groupId || null,\n        },\n      })),\n    });\n\n    return NextResponse.json(assignment, { status: 201 });\n  } catch (error) {\n    console.error(\"Error creating assignment:\", error);\n    return NextResponse.json(\n      { error: \"Failed to create assignment\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}
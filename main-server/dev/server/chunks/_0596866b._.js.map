{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///home/nghiaphunng18/HustTutorial/ITSS.1.20251/lib/prisma.ts"],"sourcesContent":["import \"dotenv/config\";\nimport { PrismaPg } from '@prisma/adapter-pg'\nimport { PrismaClient } from '../prisma/generated/client';\n\nconst connectionString = `${process.env.POSTGRES_URL}`\n\nconst adapter = new PrismaPg({ connectionString })\nconst prisma = new PrismaClient({ adapter })\n\nexport { prisma }"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;AAEA,MAAM,mBAAmB,GAAG,QAAQ,GAAG,CAAC,YAAY,EAAE;AAEtD,MAAM,UAAU,IAAI,yKAAQ,CAAC;IAAE;AAAiB;AAChD,MAAM,SAAS,IAAI,wJAAY,CAAC;IAAE;AAAQ","debugId":null}},
    {"offset": {"line": 35, "column": 0}, "map": {"version":3,"sources":["file:///home/nghiaphunng18/HustTutorial/ITSS.1.20251/app/api/classes/%5Bid%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/prisma\";\n\n// GET /api/classes/[id] - Get class details\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params;\n    const classItem = await prisma.class.findUnique({\n      where: { id },\n      include: {\n        teachers: {\n          include: {\n            teacher: {\n              select: {\n                id: true,\n                name: true,\n                email: true,\n                avatar: true,\n              },\n            },\n          },\n        },\n        enrollments: {\n          where: { status: \"ACTIVE\" },\n          include: {\n            student: {\n              select: {\n                id: true,\n                name: true,\n                email: true,\n                avatar: true,\n                studentCode: true,\n              },\n            },\n          },\n        },\n        groups: {\n          include: {\n            members: {\n              include: {\n                student: {\n                  select: {\n                    id: true,\n                    name: true,\n                    email: true,\n                    avatar: true,\n                    studentCode: true,\n                  },\n                },\n              },\n            },\n          },\n        },\n        assignments: {\n          orderBy: { dueDate: \"asc\" },\n          take: 5,\n        },\n        posts: {\n          orderBy: { createdAt: \"desc\" },\n          take: 10,\n          include: {\n            author: {\n              select: {\n                id: true,\n                name: true,\n                avatar: true,\n                groupMemberships: {\n                  where: {\n                    group: {\n                      classId: id,\n                    },\n                  },\n                  include: {\n                    group: {\n                      select: {\n                        name: true,\n                      },\n                    },\n                  },\n                },\n              },\n            },\n            attachments: true,\n            comments: {\n              include: {\n                author: {\n                  select: {\n                    id: true,\n                    name: true,\n                    avatar: true,\n                    groupMemberships: {\n                      where: {\n                        group: {\n                          classId: id,\n                        },\n                      },\n                      include: {\n                        group: {\n                          select: {\n                            name: true,\n                          },\n                        },\n                      },\n                    },\n                  },\n                },\n                attachments: true,\n              },\n            },\n            votes: true,\n          },\n        },\n        learningMaterials: {\n          orderBy: { createdAt: \"desc\" },\n        },\n      },\n    });\n\n    if (!classItem) {\n      return NextResponse.json({ error: \"Class not found\" }, { status: 404 });\n    }\n\n    // Transform posts to include groupName in author\n    const transformedClass = {\n      ...classItem,\n      posts: classItem.posts.map((post: any) => ({\n        ...post,\n        author: post.author\n          ? {\n              ...post.author,\n              groupName: post.author.groupMemberships?.[0]?.group?.name,\n              groupMemberships: undefined,\n            }\n          : null,\n        comments: post.comments?.map((comment: any) => ({\n          ...comment,\n          author: comment.author\n            ? {\n                ...comment.author,\n                groupName: comment.author.groupMemberships?.[0]?.group?.name,\n                groupMemberships: undefined,\n              }\n            : null,\n        })),\n      })),\n    };\n\n    return NextResponse.json({ class: transformedClass });\n  } catch (error) {\n    console.error(\"GET /api/classes/[id] error:\", error);\n    return NextResponse.json(\n      { error: \"Failed to fetch class\" },\n      { status: 500 }\n    );\n  }\n}\n\n// PUT /api/classes/[id] - Update class\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params;\n    const body = await request.json();\n    const { name, description, semester, year, status } = body;\n\n    const updatedClass = await prisma.class.update({\n      where: { id },\n      data: {\n        name,\n        description,\n        semester,\n        year,\n        status,\n      },\n    });\n\n    return NextResponse.json({ class: updatedClass });\n  } catch (error) {\n    console.error(\"PUT /api/classes/[id] error:\", error);\n    return NextResponse.json(\n      { error: \"Failed to update class\" },\n      { status: 500 }\n    );\n  }\n}\n\n// PATCH /api/classes/[id] - Partially update class\nexport async function PATCH(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params;\n    const body = await request.json();\n    const {\n      code,\n      name,\n      description,\n      semester,\n      year,\n      status,\n      isPrivate,\n      joinCode,\n    } = body;\n\n    // Validate joinCode if class is being set to private\n    if (isPrivate && joinCode) {\n      if (joinCode.length !== 8) {\n        return NextResponse.json(\n          { error: \"Join code must be exactly 8 characters\" },\n          { status: 400 }\n        );\n      }\n\n      // Check if joinCode is already used by another class\n      const existingCode = await prisma.class.findFirst({\n        where: {\n          joinCode,\n          NOT: { id },\n        },\n      });\n\n      if (existingCode) {\n        return NextResponse.json(\n          { error: \"Join code already exists\" },\n          { status: 409 }\n        );\n      }\n    }\n\n    const updatedClass = await prisma.class.update({\n      where: { id },\n      data: {\n        ...(code !== undefined && { code }),\n        ...(name !== undefined && { name }),\n        ...(description !== undefined && { description }),\n        ...(semester !== undefined && { semester }),\n        ...(year !== undefined && { year }),\n        ...(status !== undefined && { status }),\n        ...(isPrivate !== undefined && { isPrivate }),\n        ...(isPrivate && joinCode !== undefined && { joinCode }),\n        ...(!isPrivate && { joinCode: null }),\n      },\n    });\n\n    return NextResponse.json({ class: updatedClass });\n  } catch (error) {\n    console.error(\"PATCH /api/classes/[id] error:\", error);\n    return NextResponse.json(\n      { error: \"Failed to update class\" },\n      { status: 500 }\n    );\n  }\n}\n\n// DELETE /api/classes/[id] - Delete class\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params;\n    await prisma.class.delete({\n      where: { id },\n    });\n\n    return NextResponse.json({ message: \"Class deleted successfully\" });\n  } catch (error) {\n    console.error(\"DELETE /api/classes/[id] error:\", error);\n    return NextResponse.json(\n      { error: \"Failed to delete class\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}
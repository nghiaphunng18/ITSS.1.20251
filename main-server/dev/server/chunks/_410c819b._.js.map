{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///home/nghiaphunng18/HustTutorial/ITSS.1.20251/lib/prisma.ts"],"sourcesContent":["import \"dotenv/config\";\nimport { PrismaPg } from '@prisma/adapter-pg'\nimport { PrismaClient } from '../prisma/generated/client';\n\nconst connectionString = `${process.env.POSTGRES_URL}`\n\nconst adapter = new PrismaPg({ connectionString })\nconst prisma = new PrismaClient({ adapter })\n\nexport { prisma }"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;AAEA,MAAM,mBAAmB,GAAG,QAAQ,GAAG,CAAC,YAAY,EAAE;AAEtD,MAAM,UAAU,IAAI,yKAAQ,CAAC;IAAE;AAAiB;AAChD,MAAM,SAAS,IAAI,wJAAY,CAAC;IAAE;AAAQ","debugId":null}},
    {"offset": {"line": 35, "column": 0}, "map": {"version":3,"sources":["file:///home/nghiaphunng18/HustTutorial/ITSS.1.20251/app/api/presentations/%5Bid%5D/checkpoints/route.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/prisma\";\nimport { SaveCheckpointRequest } from \"@/types/presentation\";\n\n// POST: Tạo mới hoặc Cập nhật Checkpoint\nexport async function POST(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const presentationId = (await params).id;\n    const body: SaveCheckpointRequest = await request.json();\n    const { userId, pageNumber, question, options, correctAnswer, timeLimit } =\n      body;\n\n    // 1. Kiểm tra quyền sở hữu\n    const presentation = await prisma.presentation.findUnique({\n      where: { id: presentationId },\n    });\n\n    if (!presentation || presentation.ownerId !== userId) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 403 });\n    }\n\n    // 2. Tìm xem trang này đã có checkpoint chưa\n    const existingCheckpoint = await prisma.presentationCheckpoint.findFirst({\n      where: {\n        presentationId: presentationId,\n        pageNumber: pageNumber,\n      },\n    });\n\n    let result;\n\n    if (existingCheckpoint) {\n      // A. Nếu có rồi -> UPDATE\n      result = await prisma.presentationCheckpoint.update({\n        where: { id: existingCheckpoint.id },\n        data: {\n          question,\n          options: options as any,\n          correctAnswer: correctAnswer as any,\n          timeLimit,\n        },\n      });\n    } else {\n      // B. Nếu chưa có -> CREATE\n      result = await prisma.presentationCheckpoint.create({\n        data: {\n          presentationId,\n          pageNumber,\n          question,\n          options: options as any,\n          correctAnswer: correctAnswer as any,\n          timeLimit,\n        },\n      });\n    }\n\n    return NextResponse.json(result, { status: 200 });\n  } catch (error) {\n    console.error(\"Error saving checkpoint:\", error);\n    return NextResponse.json(\n      { error: \"Internal Server Error\" },\n      { status: 500 }\n    );\n  }\n}\n\n// DELETE: Xóa Checkpoint tại trang cụ thể\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const presentationId = (await params).id;\n\n    // Lấy pageNumber từ query param (VD: ?page=1)\n    const { searchParams } = new URL(request.url);\n    const pageNumber = searchParams.get(\"page\");\n    const userId = searchParams.get(\"userId\"); // Cần check quyền\n\n    if (!pageNumber || !userId) {\n      return NextResponse.json({ error: \"Missing params\" }, { status: 400 });\n    }\n\n    // Check quyền\n    const presentation = await prisma.presentation.findUnique({\n      where: { id: presentationId },\n    });\n\n    if (!presentation || presentation.ownerId !== userId) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 403 });\n    }\n\n    // Tìm checkpoint cần xóa\n    const checkpoint = await prisma.presentationCheckpoint.findFirst({\n      where: {\n        presentationId,\n        pageNumber: parseInt(pageNumber),\n      },\n    });\n\n    if (!checkpoint) {\n      return NextResponse.json(\n        { error: \"Checkpoint not found\" },\n        { status: 404 }\n      );\n    }\n\n    // Thực hiện xóa\n    await prisma.presentationCheckpoint.delete({\n      where: { id: checkpoint.id },\n    });\n\n    return NextResponse.json({ message: \"Deleted successfully\" });\n  } catch (error) {\n    console.error(\"Error deleting checkpoint:\", error);\n    return NextResponse.json(\n      { error: \"Internal Server Error\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}
{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///home/nghiaphunng18/HustTutorial/ITSS.1.20251/lib/prisma.ts"],"sourcesContent":["import \"dotenv/config\";\nimport { PrismaPg } from '@prisma/adapter-pg'\nimport { PrismaClient } from '../prisma/generated/client';\n\nconst connectionString = `${process.env.POSTGRES_URL}`\n\nconst adapter = new PrismaPg({ connectionString })\nconst prisma = new PrismaClient({ adapter })\n\nexport { prisma }"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;AAEA,MAAM,mBAAmB,GAAG,QAAQ,GAAG,CAAC,YAAY,EAAE;AAEtD,MAAM,UAAU,IAAI,yKAAQ,CAAC;IAAE;AAAiB;AAChD,MAAM,SAAS,IAAI,wJAAY,CAAC;IAAE;AAAQ","debugId":null}},
    {"offset": {"line": 35, "column": 0}, "map": {"version":3,"sources":["file:///home/nghiaphunng18/HustTutorial/ITSS.1.20251/app/api/classes/%5Bid%5D/attachments/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/prisma\";\n\n// Get all attachments for a class (from posts, comments, and direct uploads)\nexport async function GET(\n  req: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params;\n    // Get attachments directly uploaded to class\n    const classAttachments = await prisma.classAttachment.findMany({\n      where: { classId: id },\n      include: {\n        uploader: {\n          select: {\n            id: true,\n            name: true,\n            email: true,\n          },\n        },\n      },\n      orderBy: {\n        uploadedAt: \"desc\",\n      },\n    });\n\n    // Get attachments from posts\n    const postAttachments = await prisma.postAttachment.findMany({\n      where: {\n        post: {\n          classId: id,\n        },\n      },\n      include: {\n        post: {\n          select: {\n            id: true,\n            title: true,\n            author: {\n              select: {\n                id: true,\n                name: true,\n                email: true,\n              },\n            },\n          },\n        },\n      },\n      orderBy: {\n        uploadedAt: \"desc\",\n      },\n    });\n\n    // Get attachments from comments\n    const commentAttachments = await prisma.commentAttachment.findMany({\n      where: {\n        comment: {\n          post: {\n            classId: id,\n          },\n        },\n      },\n      include: {\n        comment: {\n          select: {\n            id: true,\n            content: true,\n            author: {\n              select: {\n                id: true,\n                name: true,\n                email: true,\n              },\n            },\n          },\n        },\n      },\n      orderBy: {\n        uploadedAt: \"desc\",\n      },\n    });\n\n    // Combine all attachments with consistent structure\n    const allAttachments = [\n      ...classAttachments.map((att) => ({\n        ...att,\n        source: \"class\",\n        uploader: att.uploader,\n      })),\n      ...postAttachments.map((att) => ({\n        ...att,\n        source: \"post\",\n        uploader: att.post.author,\n      })),\n      ...commentAttachments.map((att) => ({\n        ...att,\n        source: \"comment\",\n        uploader: att.comment.author,\n      })),\n    ].sort(\n      (a, b) =>\n        new Date(b.uploadedAt).getTime() - new Date(a.uploadedAt).getTime()\n    );\n\n    return NextResponse.json(allAttachments);\n  } catch (error) {\n    console.error(\"Error fetching attachments:\", error);\n    return NextResponse.json(\n      { error: \"Failed to fetch attachments\" },\n      { status: 500 }\n    );\n  }\n}\n\n// Upload attachment directly to class\nexport async function POST(\n  req: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params;\n    const { uploaderId, fileName, fileUrl, fileSize, mimeType } =\n      await req.json();\n\n    if (!uploaderId || !fileName || !fileUrl) {\n      return NextResponse.json(\n        { error: \"Missing required fields\" },\n        { status: 400 }\n      );\n    }\n\n    const attachment = await prisma.classAttachment.create({\n      data: {\n        classId: id,\n        uploaderId,\n        fileName,\n        fileUrl,\n        fileSize,\n        mimeType,\n      },\n      include: {\n        uploader: {\n          select: {\n            id: true,\n            name: true,\n            email: true,\n          },\n        },\n      },\n    });\n\n    return NextResponse.json(attachment, { status: 201 });\n  } catch (error) {\n    console.error(\"Error uploading attachment:\", error);\n    return NextResponse.json(\n      { error: \"Failed to upload attachment\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}